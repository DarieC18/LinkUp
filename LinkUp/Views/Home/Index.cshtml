@model LinkUp.Application.DTOs.Social.PagedResult<LinkUp.Application.DTOs.Social.PostFeedItemDto>

@{
    ViewData["Title"] = "Inicio";
}
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery
@{
    var tokens = Antiforgery.GetAndStoreTokens(Context);
}

<input type="hidden" name="__RequestVerificationToken" value="@tokens.RequestToken" />

<div class="container my-4">
    <div class="row g-4">

        <!-- Columna principal -->
        <div class="col-12 col-lg-8">

            <!-- Formulario de publicación -->
            <div class="card shadow-sm border-0 mb-4">
                <div class="card-body">
                    <h5 class="mb-3">Crear publicación</h5>

                    @if (TempData["Error"] != null)
                    {
                        <div class="alert alert-danger">@TempData["Error"]</div>
                    }
                    @if (TempData["Info"] != null)
                    {
                        <div class="alert alert-success">@TempData["Info"]</div>
                    }

                    <form asp-controller="Posts"
                          asp-action="Create"
                          method="post"
                          enctype="multipart/form-data"
                          id="postCreateForm">
                        @Html.AntiForgeryToken()

                        <!-- Texto -->
                        <div class="mb-3">
                            <label class="form-label fw-semibold" for="postContent">Contenido</label>
                            <textarea id="postContent"
                                      name="Content"
                                      class="form-control"
                                      rows="3"
                                      placeholder="¿Qué estás pensando? (requerido)"
                                      required></textarea>
                        </div>

                        <div class="row g-3 align-items-end">
                            <!-- Tipo de medio -->
                            <div class="col-md-4">
                                <label class="form-label fw-semibold" for="mediaType">Tipo de medio</label>
                                <select name="MediaType" class="form-select" id="mediaType" required>
                                    <option value="">— Selecciona —</option>
                                    <option value="image">Imagen</option>
                                    <option value="video">Video YouTube</option>
                                </select>
                            </div>

                            <!-- Imagen -->
                            <div class="col-md-8" id="imageWrap" hidden>
                                <label class="form-label fw-semibold" for="imageFile">Imagen (JPG/PNG/GIF/WEBP máx. 5MB)</label>
                                <input type="file"
                                       id="imageFile"
                                       name="ImageFile"
                                       class="form-control"
                                       accept=".jpg,.jpeg,.png,.gif,.webp"
                                       disabled />
                                <span class="text-danger" data-valmsg-for="ImageFile"></span>
                            </div>

                            <!-- URL YouTube -->
                            <div class="col-md-8" id="ytWrap" hidden>
                                <label class="form-label fw-semibold" for="youTubeUrl">URL de YouTube</label>
                                <input type="url"
                                       id="youTubeUrl"
                                       name="YouTubeUrl"
                                       class="form-control"
                                       placeholder="https://www.youtube.com/watch?v=XXXXXXXXXXX"
                                       inputmode="url"
                                       disabled />
                                <span class="text-danger" data-valmsg-for="YouTubeUrl"></span>
                            </div>
                        </div>

                        <div class="text-end mt-3">
                            <button class="btn btn-primary" type="submit">Publicar</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Mis publicaciones -->
            <h5 class="mb-3">Mis publicaciones</h5>

            @if (Model.Items.Length == 0)
            {
                <div class="text-muted">Aún no has publicado nada.</div>
            }
            else
            {
                <div class="vstack gap-3">
                    @foreach (var post in Model.Items)
                    {
                        @await Html.PartialAsync("_PostCard", post)
                    }
                </div>

                <nav class="mt-4">
                    <ul class="pagination">
                        @{
                            var totalPages = (int)Math.Ceiling((double)Model.Total / Model.PageSize);
                        }

                        @for (var i = 1; i <= totalPages; i++)
                        {
                            <li class="page-item @(i == Model.Page ? "active" : "")">
                                <a class="page-link" asp-action="Index" asp-route-page="@i">@i</a>
                            </li>
                        }
                    </ul>
                </nav>
            }
        </div>

        <!-- Panel lateral -->
        <aside class="col-12 col-lg-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title mb-3">Menú</h5>

                    <div class="d-grid gap-2">
                        <a class="btn btn-light d-flex align-items-center justify-content-between"
                           asp-controller="Home"
                           asp-action="Index">
                            <span><i class="bi bi-house"></i> Inicio</span>
                        </a>

                        <a class="btn btn-light d-flex align-items-center justify-content-between"
                           asp-controller="Friends"
                           asp-action="Index">
                            <span><i class="bi bi-people"></i> Amigos</span>
                        </a>

                        <a class="btn btn-light d-flex align-items-center justify-content-between"
                           asp-controller="FriendRequests"
                           asp-action="Index">
                            <span><i class="bi bi-envelope"></i> Solicitudes</span>
                            @await Component.InvokeAsync("PendingRequestsBadge")
                        </a>

                        <a class="btn btn-light d-flex align-items-center justify-content-between"
                           asp-controller="Battleship"
                           asp-action="Index">
                            <span><i class="bi bi-grid-3x3-gap"></i> Battleship</span>
                        </a>

                        <a class="btn btn-light d-flex align-items-center justify-content-between"
                           asp-controller="Profile"
                           asp-action="Index">
                            <span><i class="bi bi-person-circle"></i> Mi Perfil</span>
                        </a>
                    </div>
                </div>
            </div>
        </aside>

    </div>
</div>

@section Scripts {
    <partial name="~/Views/Shared/_FeedInlineScripts.cshtml" />
}


